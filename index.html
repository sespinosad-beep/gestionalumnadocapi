<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control de Alumnado - Centro Acad√©mico Privado de Ingl√©s Sevilla, 56 Bail√©n</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');

        :root {
            --primary:#1e3a5f;--primary-light:#2c5282;--primary-soft:#e8f0fe;
            --accent:#3b82f6;--accent-light:#93c5fd;--accent-soft:#dbeafe;
            --red:#dc2626;--red-light:#fca5a5;--red-soft:#fef2f2;--red-pastel:#ffe4e6;--red-dark:#991b1b;
            --bg:#f1f5f9;--bg-warm:#f8fafc;--card:#ffffff;
            --text:#1e293b;--text-secondary:#64748b;--text-muted:#94a3b8;
            --border:#e2e8f0;--border-light:#f1f5f9;
            --shadow-sm:0 1px 2px rgba(0,0,0,0.05);
            --shadow:0 4px 6px -1px rgba(0,0,0,0.07),0 2px 4px -1px rgba(0,0,0,0.04);
            --shadow-md:0 10px 15px -3px rgba(0,0,0,0.08),0 4px 6px -2px rgba(0,0,0,0.04);
            --shadow-lg:0 20px 25px -5px rgba(0,0,0,0.1),0 10px 10px -5px rgba(0,0,0,0.04);
            --radius:16px;--radius-md:12px;--radius-sm:8px;--radius-xs:6px;
        }

        *{margin:0;padding:0;box-sizing:border-box;}

        body{font-family:'Inter',system-ui,-apple-system,sans-serif;background:var(--bg);color:var(--text);min-height:100vh;-webkit-font-smoothing:antialiased;}

        .header{background:linear-gradient(135deg,var(--primary) 0%,var(--primary-light) 50%,var(--accent) 100%);color:white;box-shadow:var(--shadow-lg);position:sticky;top:0;z-index:100;}
        .header-top{display:flex;justify-content:space-between;align-items:center;padding:18px 30px;}
        .header-brand{display:flex;align-items:center;gap:15px;}
        .header-logo{width:50px;height:50px;background:rgba(255,255,255,0.2);border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:1.6rem;backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,0.15);}
        .header-info h1{font-size:1.15rem;font-weight:700;letter-spacing:-0.3px;line-height:1.3;}
        .header-info p{font-size:0.78rem;opacity:0.85;font-weight:400;margin-top:2px;}
        .header-actions{display:flex;gap:8px;align-items:center;flex-wrap:wrap;}

        .btn{padding:9px 18px;border:none;border-radius:var(--radius-sm);cursor:pointer;font-size:0.82rem;font-weight:600;display:inline-flex;align-items:center;gap:6px;transition:all 0.2s ease;text-decoration:none;font-family:inherit;}
        .btn:hover{transform:translateY(-1px);box-shadow:var(--shadow);}
        .btn:active{transform:translateY(0);}
        .btn-primary{background:var(--accent);color:white;}
        .btn-primary:hover{background:#2563eb;}
        .btn-success{background:#10b981;color:white;}
        .btn-success:hover{background:#059669;}
        .btn-danger{background:var(--red);color:white;}
        .btn-danger:hover{background:var(--red-dark);}
        .btn-warning{background:#f59e0b;color:white;}
        .btn-warning:hover{background:#d97706;}
        .btn-outline-white{background:rgba(255,255,255,0.12);border:1.5px solid rgba(255,255,255,0.35);color:white;backdrop-filter:blur(4px);}
        .btn-outline-white:hover{background:rgba(255,255,255,0.22);}
        .btn-ghost{background:transparent;color:var(--text-secondary);border:1.5px solid var(--border);}
        .btn-ghost:hover{background:var(--bg);border-color:var(--accent);color:var(--accent);}
        .btn-sm{padding:6px 14px;font-size:0.78rem;}

        .container{max-width:1440px;margin:0 auto;padding:24px;}

        .tabs{display:flex;gap:4px;margin-bottom:24px;background:var(--card);padding:6px;border-radius:var(--radius);box-shadow:var(--shadow);flex-wrap:wrap;border:1px solid var(--border-light);}
        .tab{padding:11px 22px;border:none;background:transparent;border-radius:var(--radius-md);cursor:pointer;font-size:0.88rem;font-weight:600;color:var(--text-muted);transition:all 0.25s ease;display:flex;align-items:center;gap:8px;font-family:inherit;}
        .tab:hover{background:var(--bg);color:var(--text);}
        .tab.active{background:linear-gradient(135deg,var(--primary),var(--primary-light));color:white;box-shadow:0 4px 12px rgba(30,58,95,0.3);}
        .tab-content{display:none;}
        .tab-content.active{display:block;animation:fadeIn 0.3s ease;}
        @keyframes fadeIn{from{opacity:0;transform:translateY(8px);}to{opacity:1;transform:translateY(0);}}

        .card{background:var(--card);border-radius:var(--radius);padding:28px;box-shadow:var(--shadow);margin-bottom:20px;border:1px solid var(--border-light);}
        .card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px;flex-wrap:wrap;gap:12px;}
        .card-title{font-size:1.15rem;font-weight:700;display:flex;align-items:center;gap:10px;color:var(--primary);}
        .card-title .icon{width:38px;height:38px;border-radius:var(--radius-sm);display:flex;align-items:center;justify-content:center;font-size:1.1rem;}
        .card-title .icon.blue{background:var(--accent-soft);}
        .card-title .icon.red{background:var(--red-pastel);}
        .card-title .icon.green{background:#dcfce7;}

        .week-selector{display:flex;align-items:center;gap:10px;background:var(--bg-warm);padding:10px 18px;border-radius:var(--radius-sm);border:1px solid var(--border);flex-wrap:wrap;}
        .week-selector label{font-weight:600;color:var(--text-secondary);font-size:0.85rem;}
        .week-selector input[type="week"],.week-selector input[type="date"],.week-selector select,.filter-bar select,.filter-bar input{padding:8px 14px;border:1.5px solid var(--border);border-radius:var(--radius-xs);font-size:0.85rem;background:white;color:var(--text);font-family:inherit;transition:border-color 0.2s;}
        .week-selector input:focus,.week-selector select:focus,.filter-bar select:focus,.filter-bar input:focus{outline:none;border-color:var(--accent);box-shadow:0 0 0 3px rgba(59,130,246,0.1);}

        .filter-bar{display:flex;gap:10px;align-items:center;margin-bottom:16px;flex-wrap:wrap;}
        .filter-bar select,.filter-bar input{min-width:180px;}
        .bulk-actions{display:flex;gap:8px;flex-wrap:wrap;}

        .table-container{overflow-x:auto;border-radius:var(--radius-md);border:1px solid var(--border);}
        table{width:100%;border-collapse:collapse;font-size:0.87rem;}
        thead th{background:linear-gradient(135deg,var(--primary),var(--primary-light));color:white;padding:14px 16px;text-align:left;font-weight:600;white-space:nowrap;font-size:0.82rem;letter-spacing:0.02em;text-transform:uppercase;}
        thead th:first-child{border-radius:var(--radius-md) 0 0 0;}
        thead th:last-child{border-radius:0 var(--radius-md) 0 0;}
        tbody tr{transition:background 0.15s;}
        tbody tr:hover{background:var(--primary-soft);}
        tbody tr:nth-child(even){background:var(--bg-warm);}
        tbody tr:nth-child(even):hover{background:var(--primary-soft);}
        td{padding:12px 16px;border-bottom:1px solid var(--border-light);vertical-align:middle;}

        .status-btn{padding:5px 14px;border:2px solid var(--border);border-radius:20px;cursor:pointer;font-size:0.76rem;font-weight:600;transition:all 0.2s ease;background:white;white-space:nowrap;font-family:inherit;}
        .status-btn.present{background:#dcfce7;border-color:#22c55e;color:#166534;}
        .status-btn.absent{background:var(--red-pastel);border-color:var(--red);color:var(--red-dark);}
        .status-btn.justified{background:#fef3c7;border-color:#f59e0b;color:#92400e;}
        .status-btn.good{background:#dcfce7;border-color:#22c55e;color:#166534;}
        .status-btn.bad{background:var(--red-pastel);border-color:var(--red);color:var(--red-dark);}
        .status-btn.regular{background:#fef3c7;border-color:#f59e0b;color:#92400e;}
        .status-btn.delivered{background:#dcfce7;border-color:#22c55e;color:#166534;}
        .status-btn.not-delivered{background:var(--red-pastel);border-color:var(--red);color:var(--red-dark);}
        .status-btn.late{background:#fef3c7;border-color:#f59e0b;color:#92400e;}

        .email-btn{width:34px;height:34px;border-radius:10px;border:none;background:linear-gradient(135deg,var(--primary),var(--accent));color:white;cursor:pointer;display:inline-flex;align-items:center;justify-content:center;font-size:0.95rem;transition:all 0.2s ease;}
        .email-btn:hover{transform:scale(1.1);box-shadow:0 4px 12px rgba(30,58,95,0.3);}
        .email-btn.disabled{opacity:0.25;cursor:not-allowed;pointer-events:none;}

        .edit-email-btn{width:28px;height:28px;border-radius:8px;border:1.5px solid var(--border);background:white;color:var(--text-secondary);cursor:pointer;display:inline-flex;align-items:center;justify-content:center;font-size:0.8rem;transition:all 0.2s ease;}
        .edit-email-btn:hover{border-color:var(--accent);color:var(--accent);background:var(--accent-soft);}

        .note-input{width:130px;padding:6px 10px;border:1.5px solid var(--border);border-radius:var(--radius-xs);font-size:0.8rem;font-family:inherit;transition:border-color 0.2s;}
        .note-input:focus{outline:none;border-color:var(--accent);box-shadow:0 0 0 3px rgba(59,130,246,0.1);}

        .upload-zone{border:2px dashed var(--border);border-radius:var(--radius);padding:50px 40px;text-align:center;transition:all 0.3s ease;cursor:pointer;background:linear-gradient(135deg,var(--bg-warm),var(--accent-soft));}
        .upload-zone:hover,.upload-zone.dragover{border-color:var(--accent);background:linear-gradient(135deg,var(--accent-soft),#c7d2fe);transform:translateY(-2px);box-shadow:var(--shadow-md);}
        .upload-zone .icon{font-size:3.5rem;margin-bottom:12px;}
        .upload-zone h3{font-size:1.15rem;margin-bottom:6px;color:var(--primary);font-weight:700;}
        .upload-zone p{color:var(--text-secondary);font-size:0.88rem;}
        .upload-zone input[type="file"]{display:none;}

        .stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:14px;margin-bottom:20px;}
        .stat-card{background:var(--card);border-radius:var(--radius-md);padding:20px;text-align:center;box-shadow:var(--shadow-sm);border:1px solid var(--border-light);position:relative;overflow:hidden;}
        .stat-card::before{content:'';position:absolute;top:0;left:0;right:0;height:4px;}
        .stat-card.blue::before{background:linear-gradient(90deg,var(--primary),var(--accent));}
        .stat-card.green::before{background:linear-gradient(90deg,#22c55e,#10b981);}
        .stat-card.red::before{background:linear-gradient(90deg,var(--red),#ef4444);}
        .stat-card.yellow::before{background:linear-gradient(90deg,#f59e0b,#eab308);}
        .stat-number{font-size:2rem;font-weight:800;color:var(--text);}
        .stat-label{font-size:0.78rem;color:var(--text-muted);margin-top:4px;font-weight:600;text-transform:uppercase;letter-spacing:0.03em;}

        .modal-overlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(15,23,42,0.6);backdrop-filter:blur(4px);z-index:200;justify-content:center;align-items:center;padding:20px;}
        .modal-overlay.active{display:flex;}
        .modal{background:white;border-radius:var(--radius);padding:32px;max-width:620px;width:100%;max-height:85vh;overflow-y:auto;box-shadow:var(--shadow-lg);animation:modalIn 0.3s ease;}
        @keyframes modalIn{from{opacity:0;transform:scale(0.95) translateY(10px);}to{opacity:1;transform:scale(1) translateY(0);}}
        .modal h2{margin-bottom:20px;display:flex;align-items:center;gap:10px;color:var(--primary);font-size:1.2rem;}
        .modal-actions{display:flex;gap:10px;justify-content:flex-end;margin-top:24px;flex-wrap:wrap;}

        .form-group{margin-bottom:16px;}
        .form-group label{font-weight:600;color:var(--text);display:block;margin-bottom:6px;font-size:0.85rem;}
        .form-group input,.form-group textarea,.form-group select{width:100%;padding:10px 14px;border:1.5px solid var(--border);border-radius:var(--radius-sm);font-size:0.9rem;font-family:inherit;transition:border-color 0.2s;background:white;}
        .form-group input:focus,.form-group textarea:focus,.form-group select:focus{outline:none;border-color:var(--accent);box-shadow:0 0 0 3px rgba(59,130,246,0.1);}
        .form-group textarea{min-height:110px;resize:vertical;}
        .form-group small{color:var(--text-muted);font-size:0.75rem;margin-top:4px;display:block;}

        .toast-container{position:fixed;bottom:24px;right:24px;z-index:300;display:flex;flex-direction:column;gap:10px;}
        .toast{padding:14px 22px;border-radius:var(--radius-sm);box-shadow:var(--shadow-lg);display:flex;align-items:center;gap:10px;animation:slideIn 0.3s ease;font-weight:600;font-size:0.88rem;color:white;max-width:380px;}
        .toast.success{background:linear-gradient(135deg,#059669,#10b981);}
        .toast.error{background:linear-gradient(135deg,var(--red-dark),var(--red));}
        .toast.info{background:linear-gradient(135deg,var(--primary),var(--accent));}
        @keyframes slideIn{from{transform:translateX(100%);opacity:0;}to{transform:translateX(0);opacity:1;}}

        .student-name{font-weight:600;color:var(--text);}
        .student-course{font-size:0.75rem;color:var(--primary);background:var(--primary-soft);padding:3px 10px;border-radius:12px;display:inline-block;font-weight:600;}
        .inline-flex{display:flex;gap:6px;align-items:center;}

        .week-history{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px;}
        .week-chip{padding:6px 14px;background:var(--bg);border:1.5px solid var(--border);border-radius:20px;font-size:0.78rem;font-weight:600;cursor:pointer;transition:all 0.2s;font-family:inherit;color:var(--text-secondary);}
        .week-chip:hover,.week-chip.active{background:var(--primary);color:white;border-color:var(--primary);box-shadow:0 2px 8px rgba(30,58,95,0.2);}

        .empty-state{text-align:center;padding:50px 20px;color:var(--text-muted);}
        .empty-state .icon{font-size:3.5rem;margin-bottom:12px;}
        .empty-state h3{font-size:1.1rem;margin-bottom:6px;color:var(--text-secondary);}

        .summary-list{list-style:none;padding:0;}
        .summary-list li{padding:10px 14px;border-bottom:1px solid var(--border-light);display:flex;justify-content:space-between;align-items:center;transition:background 0.15s;}
        .summary-list li:hover{background:var(--bg-warm);}
        .summary-list li:last-child{border-bottom:none;}

        .email-ok{color:#059669;font-size:0.82rem;}
        .email-missing{color:var(--red);font-style:italic;font-size:0.82rem;}

        .debug-preview{background:var(--bg-warm);border:1px solid var(--border);border-radius:var(--radius-sm);padding:16px;margin-top:16px;font-size:0.82rem;max-height:200px;overflow-y:auto;}
        .debug-preview h4{margin-bottom:8px;color:var(--primary);}
        .debug-preview code{background:var(--accent-soft);padding:2px 6px;border-radius:4px;font-size:0.78rem;}

        .course-filter-section{background:var(--bg-warm);border:1px solid var(--border);border-radius:var(--radius-sm);padding:14px 18px;margin-bottom:16px;display:flex;align-items:center;gap:12px;flex-wrap:wrap;}
        .course-filter-section label{font-weight:600;color:var(--primary);font-size:0.88rem;white-space:nowrap;}
        .course-filter-section select,.course-filter-section input{padding:8px 14px;border:1.5px solid var(--border);border-radius:var(--radius-xs);font-size:0.85rem;font-family:inherit;background:white;min-width:200px;}
        .course-filter-section select:focus,.course-filter-section input:focus{outline:none;border-color:var(--accent);}

        .day-tag{display:inline-block;padding:2px 8px;border-radius:10px;font-size:0.7rem;font-weight:600;margin:1px 2px;}
        .day-tag.absent-day{background:var(--red-pastel);color:var(--red-dark);}
        .day-tag.justified-day{background:#fef3c7;color:#92400e;}
        .day-tag.present-day{background:#dcfce7;color:#166534;}

        .gravity-btn{padding:6px 16px;border:2px solid var(--border);border-radius:20px;cursor:pointer;font-size:0.78rem;font-weight:600;background:white;font-family:inherit;transition:all 0.2s;}
        .gravity-btn.active-leve{background:#dcfce7;border-color:#22c55e;color:#166534;transform:scale(1.05);}
        .gravity-btn.active-moderada{background:#fef3c7;border-color:#f59e0b;color:#92400e;transform:scale(1.05);}
        .gravity-btn.active-grave{background:var(--red-pastel);border-color:var(--red);color:var(--red-dark);transform:scale(1.05);}
        .gravity-btn:not([class*="active"]){opacity:0.5;}

        .director-preview{background:var(--bg-warm);border:1px solid var(--border);border-radius:var(--radius-sm);padding:16px;max-height:280px;overflow-y:auto;font-size:0.8rem;white-space:pre-wrap;line-height:1.6;font-family:'Courier New',monospace;color:var(--text);}

        @media(max-width:768px){
            .header-top{flex-direction:column;gap:12px;text-align:center;}
            .header-actions{justify-content:center;}
            .tabs{justify-content:center;}
            .tab{padding:9px 16px;font-size:0.82rem;}
            .card{padding:18px;}
            .card-header{flex-direction:column;align-items:flex-start;}
            .week-selector{width:100%;}
            .filter-bar{flex-direction:column;}
            .filter-bar select,.filter-bar input{width:100%;min-width:auto;}
            td,th{padding:8px 10px;font-size:0.78rem;}
            .stats-grid{grid-template-columns:repeat(2,1fr);}
        }
    </style>
</head>
<body>

<div class="header">
    <div class="header-top">
        <div class="header-brand">
            <div class="header-logo">üéì</div>
            <div class="header-info">
                <h1>Control de Alumnado</h1>
                <p>Centro Acad√©mico Privado de Ingl√©s ¬∑ Sevilla, 56 Bail√©n</p>
            </div>
        </div>
        <div class="header-actions">
            <button class="btn btn-outline-white btn-sm" onclick="exportAllData()">üíæ Exportar</button>
            <button class="btn btn-outline-white btn-sm" onclick="importAllData()">üìÇ Importar</button>
            <button class="btn btn-outline-white btn-sm" onclick="openDirectorEmailModal()" style="border-color:rgba(147,197,253,0.7);color:#93c5fd;">üëî Email Director</button>
            <button class="btn btn-outline-white btn-sm" onclick="confirmClearAll()" style="border-color:rgba(252,165,165,0.5);color:#fca5a5;">üóëÔ∏è Borrar</button>
            <input type="file" id="importDataInput" accept=".json" style="display:none" onchange="handleImportData(event)">
        </div>
    </div>
</div>

<div class="container">
    <div class="tabs">
        <button class="tab active" onclick="switchTab('students',this)">üë• Alumnos</button>
        <button class="tab" onclick="switchTab('attendance',this)">üìã Asistencia</button>
        <button class="tab" onclick="switchTab('behavior',this)">‚≠ê Trabajo</button>
        <button class="tab" onclick="switchTab('writings',this)">‚úçÔ∏è Writings</button>
        <button class="tab" onclick="switchTab('reports',this)">üìä Informes</button>
    </div>

    <!-- ALUMNOS -->
    <div id="tab-students" class="tab-content active">
        <div class="card">
            <div class="card-header">
                <div class="card-title"><span class="icon blue">üë•</span> Gesti√≥n de Alumnos</div>
                <button class="btn btn-primary btn-sm" onclick="showAddStudentModal()">‚ûï A√±adir Alumno</button>
            </div>
            <div class="upload-zone" id="uploadZone" onclick="document.getElementById('excelInput').click()">
                <div class="icon">üìÅ</div>
                <h3>Importar desde Excel</h3>
                <p>Columnas: <strong>Nombre | Curso | Email Padre</strong></p>
                <input type="file" id="excelInput" accept=".xlsx,.xls,.csv" onchange="handleExcelUpload(event)">
            </div>
            <div class="course-filter-section" style="margin-top:20px;">
                <label>üìö Filtrar:</label>
                <select id="studentsCourseFilter" onchange="renderStudentsList()"><option value="">Todos</option></select>
                <input type="text" id="studentsSearch" placeholder="üîç Buscar..." oninput="renderStudentsList()">
            </div>
            <div id="studentsList" style="margin-top:16px;"></div>
        </div>
    </div>

    <!-- ASISTENCIA -->
    <div id="tab-attendance" class="tab-content">
        <div class="card">
            <div class="card-header">
                <div class="card-title"><span class="icon blue">üìã</span> Asistencia</div>
                <div class="week-selector">
                    <label>üìÖ Semana:</label><input type="week" id="attendanceWeek" onchange="loadWeekData('attendance')">
                    <label>üìÜ D√≠a:</label><input type="date" id="attendanceDay" onchange="loadWeekData('attendance')">
                </div>
            </div>
            <div class="filter-bar">
                <select id="attendanceCourseFilter" onchange="loadWeekData('attendance')"><option value="">Todos</option></select>
                <input type="text" id="attendanceSearch" placeholder="üîç Buscar..." oninput="loadWeekData('attendance')">
                <div class="bulk-actions">
                    <button class="btn btn-success btn-sm" onclick="setAllStatus('attendance','present')">‚úÖ Todos Presentes</button>
                    <button class="btn btn-warning btn-sm" onclick="generatePDF('attendance')">üìÑ PDF</button>
                </div>
            </div>
            <div id="attendanceStats" class="stats-grid"></div>
            <div class="table-container" id="attendanceTable"></div>
        </div>
        <div class="card"><div class="card-title" style="margin-bottom:10px;">üìÖ Historial</div><div id="attendanceWeekHistory" class="week-history"></div></div>
    </div>

    <!-- TRABAJO -->
    <div id="tab-behavior" class="tab-content">
        <div class="card">
            <div class="card-header">
                <div class="card-title"><span class="icon green">‚≠ê</span> Trabajo / Comportamiento</div>
                <div class="week-selector">
                    <label>üìÖ Semana:</label><input type="week" id="behaviorWeek" onchange="loadWeekData('behavior')">
                    <label>üìÜ D√≠a:</label><input type="date" id="behaviorDay" onchange="loadWeekData('behavior')">
                </div>
            </div>
            <div class="filter-bar">
                <select id="behaviorCourseFilter" onchange="loadWeekData('behavior')"><option value="">Todos</option></select>
                <input type="text" id="behaviorSearch" placeholder="üîç Buscar..." oninput="loadWeekData('behavior')">
                <div class="bulk-actions">
                    <button class="btn btn-success btn-sm" onclick="setAllStatus('behavior','good')">‚úÖ Todos Bien</button>
                    <button class="btn btn-warning btn-sm" onclick="generatePDF('behavior')">üìÑ PDF</button>
                </div>
            </div>
            <div id="behaviorStats" class="stats-grid"></div>
            <div class="table-container" id="behaviorTable"></div>
        </div>
        <div class="card"><div class="card-title" style="margin-bottom:10px;">üìÖ Historial</div><div id="behaviorWeekHistory" class="week-history"></div></div>
    </div>

    <!-- WRITINGS -->
    <div id="tab-writings" class="tab-content">
        <div class="card">
            <div class="card-header">
                <div class="card-title"><span class="icon red">‚úçÔ∏è</span> Writings</div>
                <div class="week-selector">
                    <label>üìÖ Semana:</label><input type="week" id="writingsWeek" onchange="loadWeekData('writings')">
                    <label>üìÜ D√≠a:</label><input type="date" id="writingsDay" onchange="loadWeekData('writings')">
                </div>
            </div>
            <div class="filter-bar">
                <select id="writingsCourseFilter" onchange="loadWeekData('writings')"><option value="">Todos</option></select>
                <input type="text" id="writingsSearch" placeholder="üîç Buscar..." oninput="loadWeekData('writings')">
                <div class="bulk-actions">
                    <button class="btn btn-success btn-sm" onclick="setAllStatus('writings','delivered')">‚úÖ Todos Entregados</button>
                    <button class="btn btn-warning btn-sm" onclick="generatePDF('writings')">üìÑ PDF</button>
                </div>
            </div>
            <div id="writingsStats" class="stats-grid"></div>
            <div class="table-container" id="writingsTable"></div>
        </div>
        <div class="card"><div class="card-title" style="margin-bottom:10px;">üìÖ Historial</div><div id="writingsWeekHistory" class="week-history"></div></div>
    </div>

    <!-- INFORMES -->
    <div id="tab-reports" class="tab-content">
        <div class="card">
            <div class="card-header">
                <div class="card-title"><span class="icon blue">üìä</span> Informes</div>
                <div class="week-selector">
                    <label>üìÖ Semana:</label><input type="week" id="reportsWeek" onchange="loadReports()">
                    <select id="reportsCourseFilter" onchange="loadReports()"><option value="">Todos</option></select>
                </div>
            </div>
        </div>
        <div class="stats-grid" id="reportStatsGrid"></div>
        <div class="card"><div class="card-title" style="margin-bottom:15px;"><span class="icon red">‚ùå</span> No asistieron</div><div id="reportAbsent"></div></div>
        <div class="card"><div class="card-title" style="margin-bottom:15px;"><span class="icon red">‚ö†Ô∏è</span> Mal trabajo / Comportamiento</div><div id="reportBadBehavior"></div></div>
        <div class="card"><div class="card-title" style="margin-bottom:15px;"><span class="icon red">üìù</span> Sin Writing</div><div id="reportNoWriting"></div></div>
        <div class="card">
            <div class="card-header"><div class="card-title"><span class="icon blue">üìÑ</span> Acciones</div></div>
            <div class="inline-flex" style="flex-wrap:wrap;gap:10px;">
                <button class="btn btn-primary" onclick="generateFullReport()">üìÑ PDF Completo</button>
                <button class="btn btn-danger" onclick="sendBulkEmails()">üìß Emails Padres</button>
                <button class="btn btn-warning" onclick="openDirectorEmailModal()">üëî Email Director</button>
            </div>
        </div>
    </div>
</div>

<!-- MODALES -->
<div class="modal-overlay" id="addStudentModal"><div class="modal">
    <h2>‚ûï A√±adir Alumno</h2>
    <div class="form-group"><label>Nombre</label><input type="text" id="newStudentName" placeholder="Nombre"></div>
    <div class="form-group"><label>Curso</label><input type="text" id="newStudentCourse" placeholder="Ej: 1¬∫ ESO A"></div>
    <div class="form-group"><label>Email Padre</label><input type="email" id="newStudentEmail" placeholder="email@ejemplo.com"></div>
    <div class="modal-actions"><button class="btn btn-ghost btn-sm" onclick="closeModal('addStudentModal')">Cancelar</button><button class="btn btn-primary btn-sm" onclick="addStudentManual()">üíæ Guardar</button></div>
</div></div>

<div class="modal-overlay" id="editStudentModal"><div class="modal">
    <h2>‚úèÔ∏è Editar Alumno</h2>
    <input type="hidden" id="editStudentId">
    <div class="form-group"><label>Nombre</label><input type="text" id="editStudentName"></div>
    <div class="form-group"><label>Curso</label><input type="text" id="editStudentCourse"></div>
    <div class="form-group"><label>Email Padre</label><input type="email" id="editStudentEmail"></div>
    <div class="modal-actions"><button class="btn btn-ghost btn-sm" onclick="closeModal('editStudentModal')">Cancelar</button><button class="btn btn-primary btn-sm" onclick="saveEditStudent()">üíæ Guardar</button></div>
</div></div>

<div class="modal-overlay" id="emailModal"><div class="modal">
    <h2>üìß Email Padre/Madre</h2>
    <div class="form-group"><label>Para:</label><input type="email" id="emailTo" readonly></div>
    <div class="form-group"><label>Alumno:</label><input type="text" id="emailStudent" readonly></div>
    <div class="form-group"><label>Asunto:</label><input type="text" id="emailSubject"></div>
    <div class="form-group"><label>Mensaje:</label><textarea id="emailBody"></textarea></div>
    <div class="modal-actions"><button class="btn btn-ghost btn-sm" onclick="closeModal('emailModal')">Cancelar</button><button class="btn btn-primary btn-sm" onclick="sendEmail()">üìß Enviar</button></div>
</div></div>

<div class="modal-overlay" id="columnMapModal"><div class="modal">
    <h2>üìä Mapear Columnas</h2>
    <div class="form-group"><label>üìõ 
